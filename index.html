<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æªåœ˜è¨‚å–®ç®¡ç†ç³»çµ±</title>
    <style>
        /* CSS æ¨£å¼ */
        /* åœ¨ style å€å¡Šæ–°å¢ [cite: 245] */
/* å¯†ç¢¼å®¹å™¨ */
.password-container {
    position: relative;
    width: 100%;
    margin-bottom: 10px;
}

/* ç´”åœ–æ¡ˆæŒ‰éˆ•ï¼ˆç„¡èƒŒæ™¯ï¼‰ */
.toggle-password {
    position: absolute;
    right: 12px; /* å¢åŠ ä¸€é»é‚Šè· */
    top: 50%;
    transform: translateY(-50%);
    
    background: none; /* ç§»é™¤èƒŒæ™¯ */
    border: none;     /* ç§»é™¤é‚Šæ¡† */
    padding: 0;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    transition: opacity 0.2s;
}

.toggle-password:hover {
    opacity: 0.7; /* æ»‘éæ™‚ç¨å¾®è®Šæ·¡ */
}

/* çœ¼ç›åœ–æ¨™é¡è‰² */
.eye-icon {
    width: 24px;
    height: 24px;
    fill: #555; /* æ”¹ç‚ºæ·±ç°è‰²ï¼Œé©åˆç™½è‰²èƒŒæ™¯ */
}

/* ç¢ºä¿æ–‡å­—ä¸æœƒè¢«åœ–æ¡ˆæ“‹ä½ */
input[type="password"], 
input[type="text"] {
    padding-right: 45px !important;
}
#imagePreviewContainer img, 
#orderDetailContent img {
    max-width: 100%;
    height: auto;
    border: 1px solid #ddd;
    margin-top: 10px;
}
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; background-color: #f4f4f9; }
        .page { display: none; padding: 20px; max-width: 800px; margin: 20px auto; background: white; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .page.active { display: block; }
        header { background-color: #333; color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
        header h1 { margin: 0; font-size: 1.5em; }
        nav button { background: none; border: none; color: white; padding: 8px 15px; margin-left: 10px; cursor: pointer; border-radius: 4px; transition: background-color 0.2s; }
        nav button:hover { background-color: #555; }
        input[type="text"], input[type="password"], input[type="email"], textarea, input[type="datetime-local"] { 
            width: 100%; 
            padding: 10px; 
            margin-bottom: 10px; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            box-sizing: border-box; 
        }
        button.primary { background-color: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.2s; }
        button.primary:hover { background-color: #0056b3; }

        header {
    display: flex;
    align-items: center;
}

nav {
    display: flex;
    align-items: center;
    margin-left: auto;
    gap: 8px;
}
.fab-button {
    display: flex;
    align-items: center;
    justify-content: center;
}

.fab-icon {
    color: white;
    font-size: 36px;
    line-height: 1;
}

        
        /* è¨‚å–®å¡ç‰‡æ¨£å¼èª¿æ•´ */
       /* ===== é€šç”¨æ¸…å–®å¡ç‰‡æ¨£å¼ï¼ˆå°é½Šåœ–ç‰‡ï¼‰ ===== */
.list-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
}

.order-card {
    background: #fff;
    border-radius: 12px;
    padding: 18px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.order-card h3 {
    margin: 0 0 8px;
    font-size: 1.1rem;
    color: #333;
}

.order-meta {
    font-size: 0.85rem;
    color: #6c757d;
    margin-bottom: 10px;
}

.order-desc {
    font-size: 0.9rem;
    color: #555;
    margin-bottom: 12px;
    line-height: 1.4;
}

/* æŒ‰éˆ•å€ */
.card-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.btn-edit {
    background: #f59e0b;
    color: white;
    border: none;
    padding: 6px 14px;
    border-radius: 8px;
    cursor: pointer;
}

.btn-detail {
    background: #3498db;
    color: white;
    border: none;
    padding: 6px 14px;
    border-radius: 8px;
    cursor: pointer;
}

.btn-edit:hover { background: #d97706; }
.btn-detail:hover { background: #2c80b4; }

        
        /* æ–°å¢æ‡¸æµ®æŒ‰éˆ•æ¨£å¼ (FAB) */
        .fab-button {
            position: fixed; 
            bottom: 30px; 
            right: 30px; 
            width: 60px;
            height: 60px;
            border-radius: 50%; 
            background-color: #dc3545; 
            color: white;
            font-size: 2em;
            line-height: 55px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.25);
            cursor: pointer;
            z-index: 1000; 
            border: none;
            transition: background-color 0.2s;
        }
        .fab-button:hover {
            background-color: #c82333;
        }

        /* åœ˜å“¡åˆ—è¡¨æ’ç‰ˆæ¨£å¼ */
        .paylist-row, .paylist-header {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            align-items: center;
        }
        .paylist-header {
            font-weight: bold;
            background-color: #f1f1f1;
            border-bottom: 2px solid #ccc;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            margin-top: 15px;
        }

        .paylist-row {
            background-color: #fff;
        }
        .paylist-row:nth-child(even) {
            background-color: #f9f9f9;
        }

        .paylist-row > div, .paylist-header > div {
            width: 15%; 
            text-align: center;
        }
        .paylist-row .col-name, .paylist-header .col-name { width: 15%; text-align: left; }
        .paylist-row .col-item, .paylist-header .col-item { width: 35%; }
        .paylist-row .col-amount, .paylist-header .col-amount { width: 10%; }
        .paylist-row .col-paid, .paylist-header .col-paid { width: 10%; }
        .paylist-row .col-note, .paylist-header .col-note { width: 20%; }

        /* ç·¨è¼¯/åªè®€æ™‚çš„è¼¸å…¥æ¡†æ¨£å¼èª¿æ•´ */
        .paylist-row input[type="text"], .paylist-row input[type="checkbox"] {
            padding: 5px;
            margin: 0;
            height: auto;
            min-height: 20px;
            box-sizing: border-box;
            width: 100%;
        }
        
        /* åªè®€ç‹€æ…‹ä¸‹çš„è¼¸å…¥æ¡†æ¨£å¼ (é–±è®€æ¨¡å¼) */
        .paylist-row input[readonly] {
            border: none;
            background: transparent;
            cursor: default;
            padding-left: 0;
            padding-right: 0;
        }
        /* åªè®€ç‹€æ…‹ä¸‹ï¼Œç¦ç”¨ Checkbox çš„é»æ“Š */
        .paylist-row input[readonly][type="checkbox"] {
            pointer-events: none;
            opacity: 0.8; 
        }

        /* ç·¨è¼¯ç‹€æ…‹ä¸‹çš„è¼¸å…¥æ¡†æ¨£å¼ (ç·¨è¼¯æ¨¡å¼) */
        .paylist-row input:not([readonly])[type="text"] {
             border: 1px solid #ccc;
        }

        .paylist-row input[type="checkbox"] {
            width: auto;
        }
          /* ===== å…¨ç«™æŒ‰éˆ•çµ±ä¸€æˆè† å›Šå‹ï¼ˆä¸æ”¹é¡è‰²ï¼‰ ===== */
button,
button.primary,
.btn-detail,
.btn-edit,
.delete-button {
    border-radius: 999px;          /* è† å›Šåœ“è§’ */
    padding: 8px 18px;             /* é«˜åº¦èˆ‡å¯¬åº¦ */
    font-size: 14px;
    font-weight: 500;
    line-height: 1.2;
    cursor: pointer;
}

/* hover æ™‚åªåšå¾®äº®ï¼Œä¸æ”¹è‰²ç³» */
button:hover,
button.primary:hover,
.btn-detail:hover,
.btn-edit:hover,
.delete-button:hover {
    filter: brightness(0.95);
}

/* æœå°‹çµæœé ï¼šè¿”å›æœå°‹æŒ‰éˆ•èˆ‡å¡ç‰‡ä¿æŒè·é›¢ */
#SearchService1 button {
    margin-top: 24px;
}

/* ===== Header é ­è²¼å€ ===== */
.avatar-wrapper {
    position: relative;
}

/* åœ“å½¢é ­è²¼æŒ‰éˆ• */
.avatar-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #1a73e8;
    color: white;
    font-size: 18px;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* æµ®å‡ºé¸å–® */
.user-menu {
    position: absolute;
    top: 50px;
    right: 0;
    width: 260px;
    background: #000000;
    border-radius: 16px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    padding: 12px;
    display: none;
    z-index: 2000;
}

/* é¡¯ç¤ºç‹€æ…‹ */
.user-menu.active {
    display: block;
}

/* é¸å–®ä¸Šæ–¹ä½¿ç”¨è€…è³‡è¨Š */
.user-menu-header {
    display: flex;
    gap: 12px;
    align-items: center;
    padding-bottom: 12px;
    border-bottom: 1px solid #eee;
    margin-bottom: 10px;
}

.user-avatar-large {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: #1a73e8;
    color: white;
    font-size: 22px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.user-greeting {
    font-size: 14px;
}

.user-greeting div:first-child {
    font-weight: 600;
}

.user-email {
    font-size: 12px;
    color: #6c757d;
}

/* é¸å–®æŒ‰éˆ• */
.user-menu button {
    width: 100%;
    border: none;
    background: none;
    padding: 10px;
    border-radius: 10px;
    cursor: pointer;
    text-align: left;
}

.user-menu button:hover {
    background: #f1f3f4;
}

    </style>
</head>
<body>

    <header id="mainHeader" style="display:none;">
        <h1>æªåœ˜ç³»çµ±</h1>
        <nav>
            <button onclick="showPage('MainPage')">ä¸»ç•«é¢</button>
            <button onclick="showPage('JoinOrder')">æˆ‘åŠ çš„å–®</button>
            <button onclick="showPage('Order')">æˆ‘æªçš„å–®</button>
            <button onclick="showPage('HistoryRecord')">æ­·å²ç´€éŒ„</button>
            <button onclick="showPage('SearchService')">æœå°‹</button>
           <div class="avatar-wrapper">
    <button class="avatar-btn" onclick="toggleUserMenu()">
        <span id="avatarText">ğŸ‘¤</span>
    </button>

    <div id="userMenu" class="user-menu">
        <div class="user-menu-header">
            <div class="user-avatar-large">ğŸ‘¤</div>
            <div class="user-greeting">
                <div id="userGreeting">ä½ å¥½ï¼</div>
                <div class="user-email" id="userAccount"></div>
            </div>
        </div>

        <button onclick="showPage('Page'); closeUserMenu()">æ›´æ”¹ç”¨æˆ¶è³‡æ–™</button>
        <button onclick="logout(); closeUserMenu()">ç™»å‡º</button>
    </div>
</div>

        </nav>
    </header>

    <div id="app-container">

        <div id="User" class="page active">
            <h2>åˆå§‹é é¢ (ç™»å…¥/è¨»å†Š)</h2>
            <p>è«‹è¼¸å…¥å¸³è™Ÿå¯†ç¢¼ç™»å…¥æˆ–è¨»å†Šã€‚</p>
            <input type="text" id="loginAccount" placeholder="å¸³è™Ÿ">
            <div class="password-container">
    <input type="password" id="loginPassword" placeholder="å¯†ç¢¼">
    <button type="button" class="toggle-password" onclick="togglePasswordVisibility('loginPassword')">
        <svg class="eye-icon" viewBox="0 0 24 24"><path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.82l2.92 2.92c1.51-1.26 2.7-2.89 3.44-4.74-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/></svg>
    </button>
</div>
            <button class="primary" onclick="login()">ç™»å…¥</button>
            <button onclick="showPage('UserProfile')">è¨»å†Š</button>
        </div>

        <div id="UserProfile" class="page">
            <h2>è¨»å†Š</h2>
            <input type="text" id="registerAccount" placeholder="**å¸³è™Ÿ: String** (å¿…å¡«)" required> 
            <div class="password-container">
    <input type="password" id="registerPassword" placeholder="å¯†ç¢¼">
    <button type="button" class="toggle-password" onclick="togglePasswordVisibility('registerPassword')">
        <svg class="eye-icon" viewBox="0 0 24 24"><path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.82l2.92 2.92c1.51-1.26 2.7-2.89 3.44-4.74-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/></svg>
    </button>
</div>
            <input type="text" id="registerName" placeholder="å§“å: String" required> 
            <input type="text" placeholder="é›»è©±: String">
            <input type="email" placeholder="é›»å­éƒµä»¶: String">
            
            <button class="primary" onclick="register()">è¨»å†Š</button>
            <button onclick="showPage('User')">è¿”å›</button>
        </div>

        <div id="MainPage" class="page">
            <h2>ä¸»ç•«é¢</h2>
            <p>æ­¡è¿å›ä¾†ï¼ä»¥ä¸‹æ˜¯æ‚¨çš„è¨‚å–®æ¦‚æ³ã€‚</p>
            <div class="card">
                <p>è«‹ä½¿ç”¨ä¸Šæ–¹çš„å°èˆªæ¬„é€²å…¥å„åŠŸèƒ½é é¢ã€‚</p>
                <p>é»æ“Šå³ä¸‹è§’çš„ç´…è‰² **+** æŒ‰éˆ•å¯ä»¥ **æ–°å¢æªåœ˜**ã€‚</p>
            </div>
        </div>

        <div id="Order" class="page">
            <h2>æˆ‘æªçš„å–® (é€²è¡Œä¸­)</h2>
            <div id="myOrderList">
                <p style="color: #6c757d;">è¼‰å…¥ä¸­...</p>
            </div>
     
        </div>
        
        <div id="OrderDetail" class="page">
            <h2>è¨‚å–®è©³æƒ…</h2>
            <div id="orderDetailContent">
                <p>è¼‰å…¥ä¸­...</p>
            </div>
            <button onclick="showPage('Order')">è¿”å›</button>
        </div>

        <div id="payment" class="page">
            <h2>æªåœ˜è³‡æ–™ (åœ˜å“¡åˆ—è¡¨)</h2>

            <div class="paylist-header">
                <div class="col-name">å§“å</div>
                <div class="col-item">å“é …</div>
                <div class="col-amount">é‡‘é¡</div>
                <div class="col-paid">å·²ä»˜</div>
                <div class="col-note">å‚™è¨»</div>
            </div>

            <div id="payListContainer">
                <button class="primary" id="editPayListButton" onclick="toggleEditMode(true)">ä¿®æ”¹</button>
    <button class="primary" id="savePayListButton" onclick="savePayList()" style="display: none; background-color: #2ecc71;">å„²å­˜ä¿®æ”¹</button>
    <button onclick="showPage('Order')">è¿”å›</button>
            </div>

            <button class="primary" id="editPayListButton" onclick="toggleEditMode(true)" style="margin-right: 10px;">ä¿®æ”¹</button>
            <button class="primary" id="savePayListButton" onclick="savePayList()" style="margin-right: 10px; display: none;">å„²å­˜æ‰€æœ‰ä¿®æ”¹</button>
            <button onclick="showPage('OrderDetail')">è¿”å›è¨‚å–®è©³æƒ…</button>
        </div>
        
        <div id="JoinOrder" class="page">
            <h2>æˆ‘åŠ çš„å–® (æˆ‘çš„å¡«å–®ç´€éŒ„)</h2>
            <div id="myJoinedOrderList">
                <p style="color: #6c757d;">è¼‰å…¥ä¸­...</p>
            </div>
          
        </div>

        <div id="HistoryRecord" class="page">
            <h2>æ­·å²ç´€éŒ„ (å·²çµæŸ)</h2>
            <div id="myHistoryOrderList">
                <p style="color: #6c757d;">è¼‰å…¥å·²çµæŸè¨‚å–®...</p>
            </div>
        
        </div>

        <div id="OrderDetail1" class="page">
            <h2>æ­·å²è¨‚å–®è©³æƒ… (é–±è®€æ¨¡å¼)</h2>
            <div id="historyOrderDetailContent">
                <p>æ­¤è™•é¡¯ç¤ºå·²çµæŸè¨‚å–®çš„è©³ç´°è³‡è¨Šã€‚</p>
            </div>
            <button onclick="showPage('HistoryRecord')">è¿”å›</button>
        </div>

        <div id="SearchService" class="page">
            <h2>æœå°‹</h2>
            <input type="text" id="searchKeyword" placeholder="é—œéµå­—: String">
            <button class="primary" onclick="searchOrder()">æœå°‹</button>
      
        </div>

        <div id="SearchService1" class="page">
            <h2>æœå°‹çµæœ</h2>
            <div id="searchResultList">
                <p style="color: #6c757d;">è«‹åœ¨ä¸Šä¸€å€‹é é¢è¼¸å…¥é—œéµå­—é€²è¡Œæœå°‹ã€‚</p>
            </div>
            <button onclick="showPage('SearchService')">è¿”å›æœå°‹</button>
        </div>

        
        <div id="SearchService2" class="page">
            <h2>åŠ æªå¯†ç¢¼</h2>
            <p id="joinOrderTitle"></p>
            <p>è«‹è¼¸å…¥åŠ å…¥å¯†ç¢¼ã€‚</p>
            <div class="password-container">
    <input type="password" id="joinPasswordInput" placeholder="å¯†ç¢¼">
    <button type="button" class="toggle-password" onclick="togglePasswordVisibility('joinPasswordInput')">
        <svg class="eye-icon" viewBox="0 0 24 24"><path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.82l2.92 2.92c1.51-1.26 2.7-2.89 3.44-4.74-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/></svg>
    </button>
</div>
            <button class="primary" onclick="checkJoinPassword()">åŠ å…¥ä¸¦æŸ¥çœ‹è¨‚å–®</button>
            <button onclick="showPage('SearchService1')">è¿”å›æœå°‹çµæœ</button>
        </div>

        <div id="SearchService3" class="page">
            <h2>è¨‚å–®è³‡è¨Š (ç¢ºèªé )</h2>
            <div id="joiningOrderDetail">
                <p><strong>æ¨™é¡Œ:</strong> <span id="infoTitle"></span></p>
                <p><strong>åº—å®¶:</strong> <span id="infoHost"></span></p>
                <p><strong>æˆªæ­¢æ™‚é–“:</strong> <span id="infoDeadline"></span></p>
                <p><strong>å‚™è¨»:</strong> <span id="infoDescription"></span></p>
                <p><strong>èœå–®:</strong> <span id="infoDescription"></span></p>

                <div id="infoMenuImageContainer" style="margin-top: 10px;">
                    <img id="infoMenuImage" src="" style="display:none;">
                </div>
            </div>
            <button class="primary" onclick="showPage('SearchService4')">å¡«å–®</button>
            <button onclick="showPage('SearchService1')">è¿”å›æœå°‹çµæœ</button>
        </div>

        <div id="SearchService4" class="page">
            <h2>å¡«å–®é é¢ (åŠ å…¥è¨‚å–®)</h2>
            <h3>åŠ å…¥è¨‚å–®ï¼š<span id="fillOrderTitle"></span></h3>
            <p>è«‹å¡«å¯«æ‚¨çš„è¨‚è³¼è³‡è¨Šï¼š</p>
            <input type="text" id="fillName" placeholder="å§“å: String" value="">
            <input type="text" id="fillPhone" placeholder="é›»è©±: String">
            <input type="text" id="fillItem" placeholder="å“é …: String">
            <input type="text" id="fillAmount" placeholder="é‡‘é¡: String">
            <input type="text" id="fillNote" placeholder="å‚™è¨»/ç‰¹æ®Šéœ€æ±‚ (ä¾‹å¦‚ï¼šåŠ çç ã€å»å†°)">
            <button class="primary" onclick="submitJoinOrder()">é€å‡º</button>
            <button onclick="showPage('SearchService3')">è¿”å›è¨‚å–®è³‡è¨Š</button>
        </div>

        <div id="SearchService5" class="page">
            <h2>ç·¨è¼¯æˆ‘çš„å¡«å–®è³‡æ–™</h2>
            <h3>è¨‚å–®ï¼š<span id="editFillOrderTitle"></span></h3>
            <p>æ‚¨å¯ä»¥ä¿®æ”¹æ‚¨çš„å“é …ã€é‡‘é¡ã€é›»è©±åŠå‚™è¨»ï¼š</p>
            <input type="hidden" id="editEntryId"> 
            <input type="text" id="editFillName" placeholder="å§“å: String (ä¸å¯æ”¹)" readonly>
            <input type="text" id="editFillPhone" placeholder="é›»è©±: String">
            <input type="text" id="editFillItem" placeholder="å“é …: String">
            <input type="text" id="editFillAmount" placeholder="é‡‘é¡: String">
            <input type="text" id="editFillNote" placeholder="å‚™è¨»/ç‰¹æ®Šéœ€æ±‚">
            
                        <div style="margin-top: 20px; display: flex; justify-content: space-between;">
                <button class="delete-button" id="deleteEntryButton" onclick="deleteJoinedEntry(parseInt(document.getElementById('editEntryId').value))">
                    ğŸ—‘ï¸ åˆªé™¤
                </button>
                <div>
                    <button class="primary" onclick="submitEditedJoinedEntry()">å„²å­˜ä¿®æ”¹</button>
                    <button onclick="showPage('JoinOrder')">å–æ¶ˆä¸¦è¿”å›</button>
                </div>
            </div>
        </div>

        <div id="NewOrderPage" class="page">
            <h2>æ–°å¢æªåœ˜ (å¡«å–®é é¢)</h2>
            <p>è«‹å¡«å¯«æ–°çš„æªåœ˜è¨‚å–®è³‡è¨Šï¼š</p>
            <input type="text" id="newOrderTitle" placeholder="æ¨™é¡Œ(å¿…å¡«)">
            <input type="text" id="newOrderHost" placeholder="ä¸»è¾¦/åº—å®¶">
            <label for="newOrderDeadline" style="margin-top: 5px; display: block;">æˆªæ­¢æ™‚é–“ **(å¿…å¡«)**</label>
            <input type="datetime-local" id="newOrderDeadline">
            <input type="text" id="newOrderContact" placeholder="è¯çµ¡é›»è©±">
            <input type="text" id="newOrderContact2" placeholder="å¹«æ¹Šå…é‹ (ä¾‹å¦‚ï¼šæ»¿ 500 å…é‹)">
            <input type="text" id="newOrderContact3" placeholder="å…¶ä»–è¯çµ¡æ–¹å¼ (ä¾‹å¦‚ï¼šLine ID)"> 
            <div class="password-container">
    <input type="password" id="newOrderPassword" placeholder="å¯†ç¢¼">
    <button type="button" class="toggle-password" onclick="togglePasswordVisibility('newOrderPassword')">
        <svg class="eye-icon" viewBox="0 0 24 24"><path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.82l2.92 2.92c1.51-1.26 2.7-2.89 3.44-4.74-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/></svg>
    </button>
</div>
            <textarea id="newOrderDescription" placeholder="å‚™è¨»"></textarea>
            <label for="newOrderImage" style="margin-top: 10px; display: block;">ä¸Šå‚³èœå–®åœ–ç‰‡</label>
            <input type="file" id="newOrderImage" accept="image/*" onchange="previewMenuImage(event)">
            <div id="imagePreviewContainer" style="margin-top: 10px;">
                <img id="menuImagePreview" src="" style="max-width: 100%; display: none; border-radius: 8px;">
            </div>

            <button class="primary" onclick="saveNewOrder()">å„²å­˜</button>
            <button onclick="cancelNewOrder()">å–æ¶ˆ</button>
        </div>
        
        <div id="Member" class="page">
            <h2>å€‹äººè¨­å®š</h2>
            <button onclick="showPage('Page')">ç”¨æˆ¶è³‡æ–™ (é€²å…¥)</button>
            <button onclick="logout()">ç™»å‡º</button>
            <button onclick="showPage('MainPage')">è¿”å›</button>
        </div>

        <div id="Page" class="page">
            <h2>ç”¨æˆ¶è³‡æ–™é é¢</h2>
            <input type="text" id="userName" placeholder="å§“å: String">
            <input type="text" id="userPhone" placeholder="é›»è©±: String">
            <input type="email" id="userEmail" placeholder="é›»å­éƒµä»¶: String">
            <button class="primary" onclick="saveUserProfile()">å„²å­˜</button>
            <button onclick="showPage('Member')">è¿”å›</button>
        </div>

    </div>

    <button class="fab-button" id="fabAddButton" onclick="showPage('NewOrderPage')" style="display:none;">
    <span class="fab-icon">+</span>
</button>

<div id="SearchService3" class="page">
    <h2>è¨‚å–®è³‡è¨Š (ç¢ºèªé )</h2>

    <div id="joiningOrderDetail">
        <p><strong>æ¨™é¡Œ:</strong> <span id="infoTitle"></span></p>
        <p><strong>åº—å®¶:</strong> <span id="infoHost"></span></p>
        <p><strong>æˆªæ­¢æ™‚é–“:</strong> <span id="infoDeadline"></span></p>

        <!-- èœå–® / å‚™è¨»æ–‡å­— -->
        <p><strong>èœå–® :</strong><br>
            <span id="infoDescription"></span>
        </p>

        <!-- â­ èœå–®åœ–ç‰‡ï¼ˆæœ€å¾Œä¸€è¡Œï¼‰ -->
        <div id="infoMenuImageContainer" style="margin-top: 12px;">
            <img id="infoMenuImage"
                 style="max-width:100%; border-radius:8px; display:none;">
        </div>
    </div>

    <button class="primary" onclick="showPage('SearchService4')">å¡«å–®</button>
    <button onclick="showPage('SearchService1')">è¿”å›æœå°‹çµæœ</button>
</div>

    <script>
        let currentUser = null;
        const scriptURL = 'https://script.google.com/macros/s/AKfycbypcDATLof8Apc2Cp1tq5dHRQGjmkmdCnYv8zE5EJwijqmPVDyBwDFDDGQcCmxz7b3pmg/exec'; 
      // âœ… æ–°å¢ï¼šå¾ localStorage é‚„åŸç™»å…¥è€…
        const savedUser = localStorage.getItem('currentUser');
        if (savedUser) {
          currentUser = JSON.parse(savedUser);
        }

        const userDatabase = new Map();
        userDatabase.set("admin", { account: "admin", password: "123", name: "ç³»çµ±ç®¡ç†å“¡", phone: "0912345678", email: "admin@example.com" });

        const orderList = [];
        let isEditing = false; 
        
        // å„²å­˜ç”¨æˆ¶åŠ å…¥çš„è¨‚å–®ç´€éŒ„ (joinedOrderEntries)
        const joinedOrderEntries = []; 
        
        let selectedOrderForJoining = null;
        // å„²å­˜ç›®å‰åœ¨ OrderDetail æˆ– payment é é¢æŸ¥çœ‹çš„è¨‚å–®ç´¢å¼•
        let currentViewingOrderIndex = -1; 

        // ====== ä¸Šå‚³èœå–® ======
        // åœ–ç‰‡é è¦½åŠŸèƒ½
function previewMenuImage(event) {
    const reader = new FileReader();
    reader.onload = function() {
        const output = document.getElementById('menuImagePreview');
        output.src = reader.result;
        output.style.display = 'block';
    };
    if (event.target.files[0]) {
        reader.readAsDataURL(event.target.files[0]);
    }
}

// ä¿®æ”¹ saveNewOrder å‡½æ•¸ [cite: 706]
function saveNewOrder() {
    // 1. æª¢æŸ¥ç™»å…¥ç‹€æ…‹èˆ‡æ¨™é¡Œ
    if (!currentUser || !currentUser.name) {
        alert('åµæ¸¬ä¸åˆ°ç”¨æˆ¶ç™»å…¥è³‡è¨Šï¼Œè«‹é‡æ–°ç™»å…¥');
        showPage('User');
        return;
    }

    const title = document.getElementById('newOrderTitle').value.trim();
    if (!title) {
        alert('è«‹å¡«å¯«è¨‚å–®æ¨™é¡Œ');
        return;
    }

    // 2. å»ºç«‹/æ›´æ–°è³‡æ–™ç‰©ä»¶
    const orderData = {
        // ä¿®æ”¹å‰‡å»¶ç”¨èˆŠ IDï¼Œæ–°å¢å‰‡ç”¢ç”Ÿæ–° ID
        id: (currentViewingOrderIndex !== -1) ? orderList[currentViewingOrderIndex].id : Date.now(),
        title: title,
        hostName: currentUser.name.trim(), // â­ ç¢ºä¿é€™è£¡ä¸€å®šæœ‰æŠ“åˆ°åå­—
        host: document.getElementById('newOrderHost')?.value || 'æœªå¡«',
        deadline: document.getElementById('newOrderDeadline')?.value || '',
        description: document.getElementById('newOrderDescription')?.value || 'ç„¡å‚™è¨»',
        menuImageUrl: document.getElementById('menuImagePreview').src || null,
        
        // ä¿ç•™å…¶ä»–æ¬„ä½
        contact: document.getElementById('newOrderContact')?.value || 'ç„¡',
        contact2: document.getElementById('newOrderContact2')?.value || 'ç„¡',
        contact3: document.getElementById('newOrderContact3')?.value || 'ç„¡',
        password: document.getElementById('newOrderPassword')?.value || '',
        
        publishTime: (currentViewingOrderIndex !== -1) ? orderList[currentViewingOrderIndex].publishTime : new Date().toLocaleString(),
        members: (currentViewingOrderIndex !== -1) ? orderList[currentViewingOrderIndex].members : []
    };

    // 3. åŸ·è¡Œå„²å­˜
    if (currentViewingOrderIndex !== -1) {
        orderList[currentViewingOrderIndex] = orderData;
        alert(`è¨‚å–®ã€Œ${title}ã€å·²æ›´æ–°å®Œæˆ`);
    } else {
        orderList.push(orderData);
        alert(`æ–°çš„æªåœ˜ã€Œ${title}ã€å·²æˆåŠŸå„²å­˜`);
    }

    // 4. é‡ç½®èˆ‡æ¸…ç©º
    currentViewingOrderIndex = -1;
    resetFormFields(); // è«‹ç¢ºèªæœ‰å»ºç«‹æ­¤æ¸…ç©ºå‡½æ•¸
    showPage('Order');
}
function handleRegister(account, password) {
  fetch(scriptURL, {
    method: 'POST',
    mode: 'no-cors', // è§£æ±ºè·¨ç¶²åŸŸå•é¡Œ
    body: JSON.stringify({
      type: "register",
      account: account,
      password: password
    })
  }).then(() => alert("è¨»å†Šè³‡æ–™å·²å­˜å…¥å¾Œå°ï¼"));
}
function handleOrder(name, phone, item, amount) {
  fetch(scriptURL, {
    method: 'POST',
    mode: 'no-cors',
    body: JSON.stringify({
      type: "order",
      name: name,
      phone: phone,
      item: item,
      amount: amount
    })
  }).then(() => alert("è¨‚å–®å·²å­˜å…¥å¾Œå°ï¼"));
}
// è¼”åŠ©æ¸…ç©ºå‡½æ•¸
function resetFormFields() {
    const ids = ['newOrderTitle', 'newOrderHost', 'newOrderDeadline', 'newOrderContact', 'newOrderContact2', 'newOrderContact3', 'newOrderPassword', 'newOrderDescription'];
    ids.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = '';
    });
    const img = document.getElementById('menuImagePreview');
    if (img) { img.style.display = 'none'; img.src = ''; }
}

        // ====== è¼”åŠ©å‡½æ•¸ï¼šæª¢æŸ¥è¨‚å–®æ˜¯å¦å·²éæœŸ ======
        function isOrderExpired(order) {
            if (!order.deadline) {
                return false; 
            }
            const deadlineTime = new Date(order.deadline).getTime();
            const currentTime = new Date().getTime();
            return currentTime > deadlineTime;
        }
        
        // ====== è¼”åŠ©å‡½æ•¸ï¼šæ ¹æ“š ID æŸ¥æ‰¾å¡«å–®ç´€éŒ„çš„ Index ======
        function getEntryIndexById(entryId) {
            return joinedOrderEntries.findIndex(entry => entry.entryData.id === entryId);
        }

        // ====== å‡½æ•¸ï¼šå‹•æ…‹æ¸²æŸ“ã€Œæˆ‘åŠ çš„å–®ã€é é¢ ======
function renderJoinedOrderList() {
    const listContainer = document.getElementById('myJoinedOrderList');
    listContainer.innerHTML = '';
    listContainer.className = 'list-grid';

    if (joinedOrderEntries.length === 0) {
        listContainer.innerHTML =
            '<p style="color:#6c757d;">ç›®å‰æ²’æœ‰åŠ å…¥ä»»ä½•è¨‚å–®ç´€éŒ„ã€‚</p>';
        return;
    }

    joinedOrderEntries.slice().reverse().forEach((entry) => {
        const order = entry.order;
        const entryData = entry.entryData;
        const expired = isOrderExpired(order);
        const statusText = expired ? 'å·²çµæŸ' : 'é€²è¡Œä¸­';
        const canEdit = !expired;
        const entryId = entryData.id;

        const card = document.createElement('div');
        card.className = 'order-card';

        const noteDisplay = entryData.note
            ? `<br><strong>å‚™è¨»ï¼š</strong>${entryData.note}`
            : '';

        card.innerHTML = `
            <div>
                <h3>[${statusText}] ${order.title}</h3>
                <div class="order-meta">ä¸»æªï¼š${order.hostName}</div>
                <div class="order-desc">
                    <strong>æˆ‘çš„å“é …ï¼š</strong>${entryData.item}
                    ï¼ˆ$${entryData.amount}ï¼‰
                    ${noteDisplay}<br>
                    <strong>æˆªæ­¢æ™‚é–“ï¼š</strong>
                    ${order.deadline ? new Date(order.deadline).toLocaleString() : 'æœªè¨­å®š'}
                </div>
            </div>

            <div class="card-actions">
                <button class="btn-detail"
                    onclick="alert(
                        'è©³ç´°å…§å®¹\\n' +
                        'å“é …ï¼š${entryData.item}\\n' +
                        'é‡‘é¡ï¼š$${entryData.amount}\\n' +
                        'é›»è©±ï¼š${entryData.phone || 'æœªå¡«'}\\n' +
                        'å‚™è¨»ï¼š${entryData.note || 'ç„¡'}'
                    )">
                    æŸ¥çœ‹æˆ‘çš„å¡«å–®
                </button>

                ${
                    canEdit
                    ? `<button class="btn-edit"
                        onclick="showEditJoinedEntryPage(${entryId})">
                        ä¿®æ”¹å¡«å–®
                       </button>`
                    : `<button class="btn-edit" disabled style="opacity:.5;cursor:default;">
                        å·²çµæŸ
                       </button>`
                }
            </div>
        `;

        listContainer.appendChild(card);
    });
}

        // ====== å‡½æ•¸ï¼šé¡¯ç¤ºä¿®æ”¹å¡«å–®é é¢ ======
        function showEditJoinedEntryPage(entryId) { 
            const index = getEntryIndexById(entryId); 
            const entry = joinedOrderEntries[index];

            if (index === -1 || !entry) {
                alert("éŒ¯èª¤ï¼šæ‰¾ä¸åˆ°è©²å¡«å–®ç´€éŒ„ã€‚");
                return;
            }

            // å°‡è³‡æ–™è¼‰å…¥åˆ°ç·¨è¼¯é é¢
            document.getElementById('editEntryId').value = entryId; 
            document.getElementById('editFillOrderTitle').textContent = entry.order.title;
            document.getElementById('editFillName').value = entry.entryData.name; 
            document.getElementById('editFillPhone').value = entry.entryData.phone;
            document.getElementById('editFillItem').value = entry.entryData.item;
            document.getElementById('editFillAmount').value = entry.entryData.amount;
            document.getElementById('editFillNote').value = entry.entryData.note || ''; 

            showPage('SearchService5');
        }

        // ====== å‡½æ•¸ï¼šåˆªé™¤åŠ å–®ç´€éŒ„ (æ–°å¢) ======
        function deleteJoinedEntry(entryId) {
            const index = getEntryIndexById(entryId); 
            
            if (index === -1 || !joinedOrderEntries[index]) {
                alert("éŒ¯èª¤ï¼šç„¡æ•ˆçš„å¡«å–®ç´€éŒ„ ID æˆ–æ‰¾ä¸åˆ°ç´€éŒ„ã€‚");
                showPage('JoinOrder');
                return;
            }

            const entry = joinedOrderEntries[index];
            const orderTitle = entry.order.title;
            
            if (!confirm(`æ‚¨ç¢ºå®šè¦åˆªé™¤åœ¨è¨‚å–®ã€Œ${orderTitle}ã€ä¸­çš„é€™ç­†åŠ å–®ç´€éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚`)) {
                return;
            }

            // 1. å¾ joinedOrderEntries (æˆ‘åŠ çš„å–®) ä¸­åˆªé™¤
            joinedOrderEntries.splice(index, 1);
            
            // 2. åŒæ­¥å¾ orderList (æˆ‘æªçš„å–®) ä¸­å°æ‡‰çš„ members é™£åˆ—åˆªé™¤
            const correspondingOrder = entry.order;
            if (correspondingOrder && correspondingOrder.members) {
                const memberIndex = correspondingOrder.members.findIndex(m => m.id === entryId);
                if (memberIndex !== -1) {
                    correspondingOrder.members.splice(memberIndex, 1);
                }
            }

            alert(`è¨‚å–®ã€Œ${orderTitle}ã€çš„å¡«å–®ç´€éŒ„å·²æˆåŠŸåˆªé™¤ï¼`);
            showPage('JoinOrder'); 
        }

        // ====== å‡½æ•¸ï¼šå„²å­˜å·²ä¿®æ”¹çš„å¡«å–®è³‡æ–™ ======
        function submitEditedJoinedEntry() {
            const entryId = parseInt(document.getElementById('editEntryId').value); 
            const index = getEntryIndexById(entryId); 
            
            if (index === -1 || !joinedOrderEntries[index]) {
                alert("éŒ¯èª¤ï¼šç„¡æ•ˆçš„å¡«å–®ç´€éŒ„ ID æˆ–æ‰¾ä¸åˆ°ç´€éŒ„ã€‚");
                return;
            }

            const newPhone = document.getElementById('editFillPhone').value;
            const newItem = document.getElementById('editFillItem').value;
            const newAmount = document.getElementById('editFillAmount').value;
            const newNote = document.getElementById('editFillNote').value; 

            if (!newItem || !newAmount) {
                alert("è«‹å¡«å¯«å“é …å’Œé‡‘é¡æ‰èƒ½å„²å­˜ä¿®æ”¹ã€‚");
                return;
            }

            // 1. æ›´æ–° joinedOrderEntries ä¸­çš„æ•¸æ“š (æˆ‘åŠ çš„å–®)
            joinedOrderEntries[index].entryData.phone = newPhone;
            joinedOrderEntries[index].entryData.item = newItem;
            joinedOrderEntries[index].entryData.amount = parseFloat(newAmount) || 0;
            joinedOrderEntries[index].entryData.note = newNote; 
            
            // 2. åŒæ­¥æ›´æ–°åˆ° orderList ä¸­å°æ‡‰çš„åœ˜å“¡æ•¸æ“š (æˆ‘æªçš„å–®)
            const correspondingOrder = joinedOrderEntries[index].order;
            if (correspondingOrder && correspondingOrder.members) {
                const memberIndex = correspondingOrder.members.findIndex(m => m.id === entryId);
                if (memberIndex !== -1) {
                    correspondingOrder.members[memberIndex].item = newItem;
                    correspondingOrder.members[memberIndex].amount = parseFloat(newAmount) || 0;
                    correspondingOrder.members[memberIndex].phone = newPhone;
                    correspondingOrder.members[memberIndex].note = newNote;
                }
            }

            alert(`è¨‚å–®ã€Œ${joinedOrderEntries[index].order.title}ã€çš„å¡«å–®è³‡æ–™å·²æˆåŠŸæ›´æ–°ï¼`);
            
            showPage('JoinOrder');
        }

        // ====== å‡½æ•¸ï¼šå‹•æ…‹æ¸²æŸ“ã€Œæˆ‘æªçš„å–®ã€é é¢ ======
      function renderOrderList() {
    const container = document.getElementById('myOrderList');
    container.innerHTML = '';
    container.className = 'list-grid';

    
        
    const activeOrders = orderList.filter(o => !isOrderExpired(o));

    if (activeOrders.length === 0) {
        container.innerHTML =
            '<p style="color:#6c757d;">ç›®å‰æ²’æœ‰ä½ å»ºç«‹çš„é€²è¡Œä¸­è¨‚å–®ã€‚</p>';
        return;
    }

    
    container.innerHTML = '';
    
    activeOrders.forEach(order => {
        const index = orderList.indexOf(order);

        const card = document.createElement('div');
        card.className = 'order-card';

        // ä¿®æ”¹å¾Œçš„ renderOrderList å‡½æ•¸ç‰‡æ®µ
card.innerHTML = `
    <div>
        <h3>${order.title}</h3>
        <div class="order-meta">ç™»è¨˜æ™‚é–“ï¼š${order.publishTime}</div>
        <div class="order-desc">
             ä¸»æªï¼š${order.hostName}<br>
             æˆªæ­¢ï¼š${new Date(order.deadline).toLocaleString()}
        </div>
    </div>
    <div class="card-actions">
      <button class="btn-detail" style="background-color: #2ecc71;" onclick="viewOrderMembers(${index})">åœ˜å“¡è³‡æ–™</button>
      <button class="btn-edit" onclick="editOrder(${index})">ä¿®æ”¹</button>
      <button class="btn-edit" style="background-color: #e74c3c;" onclick="deleteOrder(${index})">åˆªé™¤</button>
    </div>
`;
        container.appendChild(card);
    });
}

        
        // é é¢åˆ‡æ›é‚è¼¯
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            
            if (pageId === 'Order') {
                renderOrderList(); 
            } else if (pageId === 'JoinOrder') { 
                renderJoinedOrderList(); 
            } else if (pageId === 'payment') {
                isEditing = false; 
                renderPayList(); 
            } else if (pageId === 'HistoryRecord') {
                renderHistoryList(); 
            } else if (pageId === 'SearchService4') {
                // é€²å…¥å¡«å–®é é¢æ™‚ï¼Œé å¡«ä½¿ç”¨è€…åç¨±/é›»è©±
                if (currentUser) {
                    document.getElementById('fillName').value = currentUser.name || '';
                    document.getElementById('fillPhone').value = currentUser.phone || '';
                }
                if (selectedOrderForJoining) {
                     document.getElementById('fillOrderTitle').textContent = selectedOrderForJoining.title;
                }
            } else if (pageId === 'Page') {
                // è¼‰å…¥ç”¨æˆ¶è³‡æ–™
                if (currentUser) {
                    document.getElementById('userName').value = currentUser.name || '';
                    document.getElementById('userPhone').value = currentUser.phone || '';
                    document.getElementById('userEmail').value = currentUser.email || '';
                }
            }
            
            const isMainContent = ['MainPage', 'Order', 'JoinOrder', 'HistoryRecord', 'SearchService', 'Member', 'OrderDetail', 'payment', 'OrderDetail2', 'payment2', 'OrderDetail1', 'payment1', 'Page', 'SearchService1', 'SearchService2', 'SearchService3', 'SearchService4', 'NewOrderPage', 'SearchService5'].includes(pageId); 
            document.getElementById('mainHeader').style.display = isMainContent ? 'flex' : 'none';

            const fabButton = document.getElementById('fabAddButton');
            const pagesToShowFab = ['MainPage', 'Order', 'JoinOrder', 'HistoryRecord', 'SearchService', 'SearchService1', 'OrderDetail', 'payment', 'OrderDetail2', 'payment2', 'OrderDetail1', 'payment1', 'Member', 'Page'];
            const showFab = currentUser && pagesToShowFab.includes(pageId);
            fabButton.style.display = showFab ? 'block' : 'none';

            if (!currentUser && pageId !== 'User' && pageId !== 'UserProfile') {
                showPage('User');
                alert('è«‹å…ˆç™»å…¥ï¼');
            }
        }
      function login() 
   {
    const account = document.getElementById('loginAccount').value;
    const password = document.getElementById('loginPassword').value;

    if (!account || !password) 
    {
        alert('è«‹è¼¸å…¥å¸³è™Ÿå’Œå¯†ç¢¼ã€‚');
        return;
    }

    if (!userDatabase.has(account)) 
    {
        alert('ç™»å…¥å¤±æ•—ï¼šå¸³è™Ÿä¸å­˜åœ¨ã€‚');
        return;
    }

    const userData = userDatabase.get(account);

    if (userData.password === password)
    {
        currentUser = userData;

        // âœ… æ–°å¢ï¼šå­˜é€² localStorageï¼ˆé—œéµï¼‰
        localStorage.setItem('currentUser', JSON.stringify(userData));

        alert(`ç™»å…¥æˆåŠŸï¼æ­¡è¿ ${userData.name}`);
        showPage('MainPage');
    } 
    else
    {
        alert('ç™»å…¥å¤±æ•—ï¼šå¯†ç¢¼éŒ¯èª¤ã€‚');
    }
   }

        function register() {
            const newAccount = document.getElementById('registerAccount').value; 
            const newPassword = document.getElementById('registerPassword').value; 
            const newName = document.getElementById('registerName').value; 
            const phone = document.querySelector('#UserProfile input[placeholder="é›»è©±: String"]').value;
            const email = document.querySelector('#UserProfile input[placeholder="é›»å­éƒµä»¶: String"]').value;

            if (!newAccount || !newPassword || !newName) 
            {
                alert("è¨»å†Šå¤±æ•—ï¼šå¸³è™Ÿã€å¯†ç¢¼å’Œå§“åéƒ½å¿…é ˆå¡«å¯«ã€‚");
                return;
            }

            if (userDatabase.has(newAccount)) 
            {
                alert("è¨»å†Šå¤±æ•—ï¼šæ­¤å¸³è™Ÿå·²è¢«è¨»å†Šã€‚");
                return;
            }
            userDatabase.set(newAccount, 
            {
                account: newAccount,
                password: newPassword,
                name: newName,
                phone: phone,
                email: email
            });
    
            alert(`è¨»å†ŠæˆåŠŸï¼å¸³è™Ÿï¼š${newAccount}`);
            showPage('User'); 
        }
        
     function saveUserProfile() {
    if (currentUser) {
        currentUser.name = document.getElementById('userName').value;
        currentUser.phone = document.getElementById('userPhone').value;
        currentUser.email = document.getElementById('userEmail').value;

        // å­˜å› userDatabase
        userDatabase.set(currentUser.account, currentUser);

        // â­ ä¸€å®šè¦åŠ ï¼šåŒæ­¥æ›´æ–° localStorageï¼ˆé—œéµï¼‰
        localStorage.setItem('currentUser', JSON.stringify(currentUser));

        alert('å€‹äººè³‡æ–™å·²å„²å­˜ï¼');
    }
}

      function logout() {
    currentUser = null;

    // âœ… æ–°å¢ï¼šæ¸…é™¤ localStorage çš„ç™»å…¥è€…
    localStorage.removeItem('currentUser');

    alert('ç™»å‡ºæˆåŠŸã€‚');
    showPage('User');
}

        // ====== å‡½æ•¸ï¼šæœå°‹è¨‚å–® (ä¿®æ­£ï¼šåªæœå°‹æ¨™é¡Œçš„é€£çºŒå­å­—ä¸²) ======
      function searchOrder() {
    const keyword = document.getElementById('searchKeyword').value.trim().toLowerCase();
    const resultList = document.getElementById('searchResultList');
    resultList.innerHTML = '';
    resultList.className = 'list-grid';

    if (keyword === '') {
        alert('è«‹è¼¸å…¥æœå°‹é—œéµå­—ã€‚');
        return;
    }

    const searchResults = orderList.filter(order =>
        order.title.toLowerCase().includes(keyword)
    );

    if (searchResults.length === 0) {
        resultList.innerHTML =
            `<p style="color:#6c757d;">æ²’æœ‰æ‰¾åˆ°èˆ‡ã€Œ${keyword}ã€ç›¸é—œçš„è¨‚å–®ã€‚</p>`;
    } else {
        searchResults.forEach(order => {
            const isExpired = isOrderExpired(order);
            const statusText = isExpired ? 'å·²çµæŸ' : 'é€²è¡Œä¸­';
            const buttonText = isExpired ? 'æŸ¥çœ‹è©³æƒ…' : 'åŠ å…¥è¨‚å–®';

            const card = document.createElement('div');
            card.className = 'order-card';

            card.onclick = function () {
                if (isExpired) {
                    showHistoryOrderDetail(orderList.indexOf(order));
                } else {
                    selectedOrderForJoining = order;
                    document.getElementById('joinOrderTitle').textContent =
                        `è¨‚å–®ï¼š${order.title}`;
                    document.getElementById('joinPasswordInput').value = '';
                    showPage('SearchService2');
                }
            };

            card.innerHTML = `
                <div>
                    <h3>[${statusText}] ${order.title}</h3>
                    <div class="order-meta">
                        åº—å®¶ï¼š${order.host}
                    </div>
                    <div class="order-desc">
                        æˆªæ­¢æ™‚é–“ï¼š
                        ${order.deadline
                            ? new Date(order.deadline).toLocaleDateString()
                            : 'æœªè¨­å®š'}
                    </div>
                </div>

                <div class="card-actions">
                    <button class="btn-detail"
                        onclick="event.stopPropagation(); this.parentNode.parentNode.click();">
                        ${buttonText}
                    </button>
                </div>
            `;

            resultList.appendChild(card);
        });
    }

    showPage('SearchService1');
}

        function checkJoinPassword() {
    const pwdInput = document.getElementById('joinPasswordInput').value;
    
    // 1. é©—è­‰å¯†ç¢¼ (å°æ¯” order ç‰©ä»¶ä¸­çš„ password)
    // æ³¨æ„ï¼šè«‹ç¢ºä¿æ‚¨çš„ saveNewOrder æœ‰å„²å­˜ password æ¬„ä½
    if (pwdInput === selectedOrderForJoining.password || selectedOrderForJoining.password === "") {
        
        // 2. å¡«å……æ–‡å­—è³‡è¨Š
        document.getElementById('infoTitle').textContent = selectedOrderForJoining.title;
        document.getElementById('infoHost').textContent = selectedOrderForJoining.host || 'æœªå¡«';
        document.getElementById('infoDeadline').textContent = selectedOrderForJoining.deadline ? new Date(selectedOrderForJoining.deadline).toLocaleString() : 'æœªè¨­å®š';
        document.getElementById('infoDescription').textContent = selectedOrderForJoining.description || 'ç„¡å‚™è¨»';
        
        // 3. â­ é¡¯ç¤ºåœ–ç‰‡çš„æ ¸å¿ƒé‚è¼¯ â­
        const infoImg = document.getElementById('infoMenuImage');
        
        if (selectedOrderForJoining.menuImageUrl) {
            // å¦‚æœè¨‚å–®æœ‰åœ–ç‰‡æ•¸æ“š (Base64 æˆ– URL)
            infoImg.src = selectedOrderForJoining.menuImageUrl;
            infoImg.style.display = 'block'; // é¡¯ç¤ºåœ–ç‰‡
            infoImg.style.maxWidth = '100%'; // ç¢ºä¿ä¸è¶…å‡ºé‚Šæ¡†
            infoImg.style.marginTop = '15px';
        } else {
            // å¦‚æœæ²’æœ‰åœ–ç‰‡
            infoImg.src = '';
            infoImg.style.display = 'none'; // éš±è—åœ–ç‰‡æ¨™ç±¤
        }
        
        // 4. åˆ‡æ›é é¢
        showPage('SearchService3');
    } else {
        alert("å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥ã€‚");
    }
}
        
        function showOrderInfo(order) {
    document.getElementById('infoTitle').textContent = order.title || 'ç„¡';
    document.getElementById('infoHost').textContent = order.host || 'ç„¡';
    document.getElementById('infoDeadline').textContent =
        order.deadline ? new Date(order.deadline).toLocaleString() : 'æœªè¨­å®š';

    document.getElementById('infoDescription').innerHTML =
        order.description ? order.description.replace(/\n/g, '<br>') : 'ç„¡';

    // â­ èœå–®åœ–ç‰‡é¡¯ç¤ºï¼ˆé‡é»ï¼‰
    const img = document.getElementById('infoMenuImage');
    if (order.menuImageUrl) {
        img.src = order.menuImageUrl;
        img.style.display = 'block';
    } else {
        img.style.display = 'none';
    }

    showPage('SearchService3');
}

        // ====== å‡½æ•¸ï¼šé€å‡ºåŠ å…¥è¨‚å–®çš„è³‡æ–™ ======
        function submitJoinOrder() {
            if (!selectedOrderForJoining) {
                alert("éŒ¯èª¤ï¼šæœªé¸æ“‡ä»»ä½•è¨‚å–®ï¼Œç„¡æ³•é€å‡ºã€‚");
                showPage('SearchService1');
                return;
            }

            const name = document.getElementById('fillName').value;
            const phone = document.getElementById('fillPhone').value;
            const item = document.getElementById('fillItem').value;
            const amount = document.getElementById('fillAmount').value;
            const note = document.getElementById('fillNote').value; 

            if (!name || !item || !amount) {
                alert("è«‹å¡«å¯«å§“åã€å“é …å’Œé‡‘é¡æ‰èƒ½é€å‡ºã€‚");
                return;
            }

            const entryData = {
                id: Date.now(), 
                name: name,
                phone: phone,
                item: item,
                amount: parseFloat(amount) || 0,
                note: note || '', 
                isPaid: false, 
                joinTime: new Date().toLocaleString()
            };
            
            // 1. å°‡å¡«å–®è³‡æ–™æ¨å…¥åˆ°ã€Œè¨‚å–®ç‰©ä»¶ã€è‡ªå·±çš„åœ˜å“¡é™£åˆ—ä¸­
            if (!selectedOrderForJoining.members) {
                 selectedOrderForJoining.members = [];
            }
            selectedOrderForJoining.members.push(entryData);

            // 2. å°‡å¡«å–®è³‡æ–™åŒæ­¥åˆ° joinedOrderEntries (æˆ‘åŠ çš„å–®)
            joinedOrderEntries.push({
                order: selectedOrderForJoining,
                entryData: entryData
            });

            console.log(`å·²å°‡æ–°åœ˜å“¡è³‡æ–™æäº¤çµ¦è¨‚å–®: ${selectedOrderForJoining.title}`, entryData);

            // æ¸…ç©ºæ¬„ä½
            document.getElementById('fillItem').value = '';
            document.getElementById('fillAmount').value = '';
            document.getElementById('fillNote').value = ''; 
            
            alert(`æˆåŠŸåŠ å…¥è¨‚å–®ã€Œ${selectedOrderForJoining.title}ã€ï¼æ‚¨çš„å¡«å–®ç´€éŒ„å·²åŒæ­¥åˆ°ã€Œæˆ‘åŠ çš„å–®ã€ã€‚`);
            selectedOrderForJoining = null; // æ¸…ç©ºé¸æ“‡ç‹€æ…‹
            showPage('JoinOrder'); 
        }

        
      function renderHistoryList() {
    const listContainer = document.getElementById('myHistoryOrderList');
    if (!listContainer) return; // é˜²å‘†ï¼šæ‰¾ä¸åˆ°å®¹å™¨å°±ä¸åŸ·è¡Œ

    listContainer.innerHTML = ''; // æ¸…ç©ºå…§å®¹
    listContainer.className = 'list-grid';

    // 1. ç¯©é¸å‡ºå·²çµæŸçš„è¨‚å–®
    const expiredOrders = orderList.filter(order => isOrderExpired(order));

    // 2. å¦‚æœæ²’æœ‰æ­·å²ç´€éŒ„ï¼Œé¡¯ç¤ºæç¤ºæ–‡å­—
    if (expiredOrders.length === 0) {
        listContainer.innerHTML = '<p style="color:#6c757d; text-align:center; width:100%;">ç›®å‰æ²’æœ‰å·²çµæŸçš„æ­·å²è¨‚å–®ç´€éŒ„ã€‚</p>';
        return;
    }

    // 3. åŸ·è¡Œæ¸²æŸ“ (ä½¿ç”¨ slice().reverse() è®“æœ€æ–°çš„æ­·å²ç´€éŒ„æ’åœ¨æœ€å‰é¢)
    expiredOrders.slice().reverse().forEach((order) => {
        // ç²å–è©²è¨‚å–®åœ¨åŸå§‹ orderList ä¸­çš„ç´¢å¼•ï¼Œç¢ºä¿ã€ŒæŸ¥çœ‹ã€æŒ‰éˆ•èƒ½æŠ“åˆ°æ­£ç¢ºè³‡æ–™
        const originalIndex = orderList.indexOf(order);
        
        const card = document.createElement('div');
        card.className = 'order-card'; // çµ±ä¸€ä½¿ç”¨ä½ çš„ order-card æ¨£å¼
        
        // é»æ“Šæ•´å€‹å¡ç‰‡ä¹Ÿèƒ½æŸ¥çœ‹è©³æƒ…
        card.onclick = function() { showHistoryOrderDetail(originalIndex); };

        card.innerHTML = `
            <div>
                <h3><span style="color:#e74c3c;">[å·²çµæŸ]</span> ${order.title}</h3>
                <div class="order-meta">
                    ä¸»æªï¼š${order.hostName || 'æœªçŸ¥'} ï½œ åº—å®¶ï¼š${order.host || 'æœªå¡«'}
                </div>
                <div class="order-desc">
                    æˆªæ­¢æ™‚é–“ï¼š${order.deadline ? new Date(order.deadline).toLocaleString() : 'æœªè¨­å®š'}
                </div>
            </div>
            <div class="card-actions">
                <button class="btn-detail" 
                    onclick="event.stopPropagation(); showHistoryOrderDetail(${originalIndex})">
                    æŸ¥çœ‹æ­·å²è©³æƒ…
                </button>
            </div>
        `;
        listContainer.appendChild(card);
    });
}
        function showHistoryOrderDetail(index) {
            const order = orderList[index];
            const detailContainer = document.getElementById('historyOrderDetailContent');

            detailContainer.innerHTML = `
                <p><strong>æ¨™é¡Œ:</strong> ${order.title}</p>
                <p><strong>ä¸»è¾¦/åº—å®¶:</strong> ${order.host}</p>
                <p><strong>ç™¼å¸ƒæ™‚é–“:</strong> ${order.publishTime}</p>
                <p><strong>æˆªæ­¢æ™‚é–“:</strong> ${order.deadline ? new Date(order.deadline).toLocaleString() : 'æœªè¨­å®š'}</p>
                <p><strong>è¯çµ¡é›»è©±:</strong> ${order.contact}</p>
                <p><strong>å¹«æ¹Šå…é‹è³‡è¨Š:</strong> ${order.contact2}</p>
                <p><strong>å…¶ä»–è¯çµ¡æ–¹å¼:</strong> ${order.contact3}</p>
                <p><strong>èœå–®/å‚™è¨»:</strong> <br>${order.description.replace(/\n/g, '<br>')}</p>
                <hr>
                <p style="color: #dc3545; font-weight: bold;">æ­¤è¨‚å–®å·²çµæŸï¼Œç„¡æ³•åŠ å…¥æˆ–ç·¨è¼¯ã€‚</p>
            `;
            showPage('OrderDetail1');
        }

        function showOrderDetail(index) {
    currentViewingOrderIndex = index;
    const order = orderList[index];
    const detailContainer = document.getElementById('orderDetailContent');

    if (!order) {
        detailContainer.innerHTML = '<p style="color:red;">æ‰¾ä¸åˆ°è¨‚å–®è³‡æ–™</p>';
        showPage('OrderDetail');
        return;
    }

    const imageHtml = order.menuImageUrl
        ? `<div style="margin:15px 0;">
               <img src="${order.menuImageUrl}"
                    style="max-width:100%; border-radius:8px;">
           </div>`
        : '<p style="color:#888;">ï¼ˆç„¡èœå–®åœ–ç‰‡ï¼‰</p>';

    const descriptionHtml = order.description
        ? order.description.replace(/\n/g, '<br>')
        : 'ç„¡';

    detailContainer.innerHTML = `
        <p><strong>æ¨™é¡Œï¼š</strong>${order.title || 'ç„¡'}</p>
        <p><strong>ä¸»æªï¼š${order.hostName}
        <p><strong>åº—å®¶ï¼š</strong>${order.host || 'ç„¡'}</p>
        <p><strong>ç™¼å¸ƒæ™‚é–“ï¼š</strong>${order.publishTime || 'ç„¡'}</p>
        <p><strong>æˆªæ­¢æ™‚é–“ï¼š</strong>
            ${order.deadline ? new Date(order.deadline).toLocaleString() : 'æœªè¨­å®š'}
        </p>
        <p><strong>è¯çµ¡é›»è©±ï¼š</strong>${order.contact || 'ç„¡'}</p>
        <p><strong>å¹«æ¹Šå…é‹è³‡è¨Šï¼š</strong>${order.contact2 || 'ç„¡'}</p>
        <p><strong>å…¶ä»–è¯çµ¡æ–¹å¼ï¼š</strong>${order.contact3 || 'ç„¡'}</p>
        <p><strong>åŠ å–®å¯†ç¢¼ï¼š</strong>${order.password || 'ç„¡'}</p>

        <hr>

        <p><strong>èœå–® / å‚™è¨»ï¼š</strong><br>${descriptionHtml}</p>

        ${imageHtml}

        <hr>

        <button class="primary" onclick="showPage('payment')">
            æŸ¥çœ‹æªåœ˜è³‡æ–™ï¼ˆåœ˜å“¡ / ä»˜æ¬¾ç‹€æ…‹ï¼‰
        </button>
    `;

    showPage('OrderDetail');
}

        
        // ====== å‡½æ•¸ï¼šæ¸²æŸ“åœ˜å“¡åˆ—è¡¨ (æˆ‘æªçš„å–®) ======
        function renderPayList() {
    const container = document.getElementById('payListContainer');
    const order = orderList[currentViewingOrderIndex];
    if (!order) return;

    container.innerHTML = '';
    const readOnlyAttr = isEditing ? '' : 'readonly';

    order.members.forEach((member, idx) => {
        const row = document.createElement('div');
        row.className = 'paylist-row';
        row.innerHTML = `
            <div class="col-name">${member.name}</div>
            <div class="col-item">
                <input type="text" id="inputItem_${idx}" value="${member.item}" ${readOnlyAttr}>
            </div>
            <div class="col-amount">
                <input type="number" id="inputAmount_${idx}" value="${member.amount}" ${readOnlyAttr}>
            </div>
            <div class="col-paid">
                <input type="checkbox" id="inputPaid_${idx}" ${member.paid ? 'checked' : ''} ${isEditing ? '' : 'disabled'}>
            </div>
            <div class="col-note">
                <input type="text" id="inputNote_${idx}" value="${member.note || ''}" ${readOnlyAttr}>
            </div>
        `;
        container.appendChild(row);
    });
}

        function toggleEditMode(enable) {
    isEditing = enable; // æ›´æ–°å…¨åŸŸè®Šæ•¸
    
    // 1. åˆ‡æ›æŒ‰éˆ•é¡¯ç¤º
    document.getElementById('editPayListButton').style.display = enable ? 'none' : 'inline-block';
    document.getElementById('savePayListButton').style.display = enable ? 'inline-block' : 'none';
    
    // 2. é‡æ–°æ¸²æŸ“åˆ—è¡¨ï¼ˆrenderPayList æœƒæ ¹æ“š isEditing æ±ºå®šæ˜¯å¦åŠ  readonlyï¼‰
    renderPayList();
}

        function updatePaymentButtons(hideAll = false, noMembers = false) {
            const editBtn = document.getElementById('editPayListButton');
            const saveBtn = document.getElementById('savePayListButton');
            
            if (hideAll || noMembers) {
                editBtn.style.display = 'none';
                saveBtn.style.display = 'none';
            } else {
                editBtn.style.display = isEditing ? 'none' : 'inline-block';
                saveBtn.style.display = isEditing ? 'inline-block' : 'none';
            }
        }

        function handlePaidChange(memberId, isChecked) {
            const currentOrder = orderList[currentViewingOrderIndex];
            if (!currentOrder || !currentOrder.members) return;

            const member = currentOrder.members.find(m => m.id === memberId);
            if (member) {
                member.isPaid = isChecked;
                
                // åŒæ­¥æ›´æ–°åˆ° joinedOrderEntries
                const joinedEntryIndex = getEntryIndexById(memberId);
                if (joinedEntryIndex !== -1) {
                    joinedOrderEntries[joinedEntryIndex].entryData.isPaid = isChecked;
                }
            }
        }

        // ====== å‡½æ•¸ï¼šå„²å­˜åœ˜å“¡åˆ—è¡¨ (æˆ‘æªçš„å–®) ======
        function savePayList() {
    const order = orderList[currentViewingOrderIndex];
    
    // 1. å¾ªç’°æ‰€æœ‰åœ˜å“¡ä¸¦æŠ“å–æ–°å€¼
    order.members.forEach((member, idx) => {
        const newItem = document.getElementById(`inputItem_${idx}`).value;
        const newAmount = parseFloat(document.getElementById(`inputAmount_${idx}`).value) || 0;
        const newPaid = document.getElementById(`inputPaid_${idx}`).checked;
        const newNote = document.getElementById(`inputNote_${idx}`).value;

        // 2. æ›´æ–°ä¸»æªçœ‹åˆ°çš„ order ç‰©ä»¶
        member.item = newItem;
        member.amount = newAmount;
        member.paid = newPaid;
        member.note = newNote;

        // 3. â­ åŒæ­¥æ›´æ–°ã€ŒåƒåŠ è€…ã€ç«¯çš„ joinedOrderEntries è³‡æ–™ â­
        // é€é member.id (åœ¨å¡«å–®æ™‚ç”¢ç”Ÿçš„ Date.now()) ä¾†å°‹æ‰¾å°æ‡‰ç´€éŒ„
        const entryIdx = joinedOrderEntries.findIndex(e => e.entryData.id === member.id);
        if (entryIdx !== -1) {
            joinedOrderEntries[entryIdx].entryData.item = newItem;
            joinedOrderEntries[entryIdx].entryData.amount = newAmount;
            joinedOrderEntries[entryIdx].entryData.paid = newPaid;
            joinedOrderEntries[entryIdx].entryData.note = newNote;
        }
    });

    alert("ä¿®æ”¹æˆåŠŸï¼æ‰€æœ‰åœ˜å“¡è³‡æ–™å·²åŒæ­¥æ›´æ–°ã€‚");
    toggleEditMode(false); // å„²å­˜å®Œå¾Œå›åˆ°åªè®€æ¨¡å¼
}
        
        function cancelNewOrder() {
            if (confirm("ç¢ºå®šè¦å–æ¶ˆä¸¦åˆªé™¤æ‰€æœ‰å·²å¡«å¯«çš„è³‡è¨Šå—ï¼Ÿ")) {
                // æ¸…ç©ºæ¬„ä½
                document.getElementById('newOrderTitle').value = '';
                document.getElementById('newOrderHost').value = '';
                document.getElementById('newOrderDeadline').value = '';
                document.getElementById('newOrderContact').value = '';
                document.getElementById('newOrderContact2').value = '';
                document.getElementById('newOrderContact3').value = '';
                document.getElementById('newOrderPassword').value = '';
                document.getElementById('newOrderDescription').value = '';

                alert("å·²å–æ¶ˆå¡«å–®ã€‚");
                showPage('MainPage'); 
            }
        }
        
        // åˆå§‹è¼‰å…¥ï¼šé¡¯ç¤ºç™»å…¥é é¢
        document.addEventListener('DOMContentLoaded', () => {
            console.log("ç³»çµ±å·²å•Ÿå‹•ã€‚");
            showPage('User');
        });
//é ­è²¼åŠŸèƒ½
function toggleUserMenu() {
    const menu = document.getElementById('userMenu');
    menu.classList.toggle('active');

    if (currentUser) {
        document.getElementById('userGreeting').textContent =
            `${currentUser.name}ï¼Œä½ å¥½ï¼`;
        document.getElementById('userAccount').textContent =
            currentUser.account;
    }
}

function closeUserMenu() {
    document.getElementById('userMenu').classList.remove('active');
}

function deleteOrder(index) {
    const order = orderList[index];
    if (!order) return;

    if (!confirm(`ç¢ºå®šè¦åˆªé™¤è¨‚å–®ã€Œ${order.title}ã€ï¼Ÿ\næ­¤å‹•ä½œæœƒä¸€ä½µåˆªé™¤æ‰€æœ‰å¡«å–®è³‡æ–™ï¼Œç„¡æ³•å¾©åŸã€‚`)) {
        return;
    }

    // 1. åˆªé™¤æ‰€æœ‰ã€Œæˆ‘åŠ çš„å–®ã€ä¸­å±¬æ–¼æ­¤è¨‚å–®çš„è³‡æ–™
    for (let i = joinedOrderEntries.length - 1; i >= 0; i--) {
        if (joinedOrderEntries[i].order === order) {
            joinedOrderEntries.splice(i, 1);
        }
    }
    // 2. å¾è¨‚å–®æ¸…å–®åˆªé™¤
    orderList.splice(index, 1);

    alert(`è¨‚å–®ã€Œ${order.title}ã€å·²åˆªé™¤`);
    renderOrderList();
}

function deleteMember(memberId) {
    const order = orderList[currentViewingOrderIndex];
    if (!order || !order.members) return;

    if (!confirm("ç¢ºå®šè¦åˆªé™¤æ­¤å¡«å–®è€…ï¼Ÿ")) return;

    // 1. å¾è¨‚å–®çš„ members ç§»é™¤
    order.members = order.members.filter(m => m.id !== memberId);

    // 2. å¾ã€Œæˆ‘åŠ çš„å–®ã€åŒæ­¥åˆªé™¤
    const index = joinedOrderEntries.findIndex(e => e.entryData.id === memberId);
    if (index !== -1) {
        joinedOrderEntries.splice(index, 1);
    }

    renderPayList();
}
//æˆ‘å•¾çš„å–®ä¿®æ”¹æŒ‰éˆ•
function viewOrderMembers(orderIndex) {
    const order = orderList[orderIndex];
    currentViewingOrderIndex = orderIndex; // ç´€éŒ„ç›®å‰æ­£åœ¨çœ‹çš„è¨‚å–®ç´¢å¼•

    // 1. å¾æ‰€æœ‰å¡«å–®ç´€éŒ„ä¸­ï¼Œç¯©é¸å‡ºã€Œå±¬æ–¼é€™ç­†è¨‚å–®ã€çš„è³‡æ–™
    // é€™è£¡å‡è¨­æ‚¨çš„ entry ç‰©ä»¶çµæ§‹ä¸­æœ‰å­˜ order çš„ id
    const members = joinedOrderEntries.filter(entry => entry.order.id === order.id);

    // 2. å°‡ç¯©é¸å‡ºçš„æˆå“¡æš«å­˜åˆ°è©² order ç‰©ä»¶ä¸­ï¼Œä»¥ä¾¿ payment é é¢è®€å–
    // é€™æ¨£å¯ä»¥ç¢ºä¿é¡¯ç¤ºçš„æ˜¯æœ€æ–°æœå°‹åŠ å…¥çš„æˆå“¡
    order.members = members.map(m => m.entryData);

    // 3. åˆ‡æ›åˆ° payment é é¢
    showPage('payment');
}
function editOrder(index) {
    const order = orderList[index];
    currentViewingOrderIndex = index;

    document.getElementById('newOrderTitle').value = order.title || '';
    document.getElementById('newOrderHost').value = order.host || '';
    document.getElementById('newOrderDeadline').value = order.deadline || '';
    document.getElementById('newOrderContact').value = order.contact || '';
    document.getElementById('newOrderContact2').value = order.contact2 || '';
    document.getElementById('newOrderContact3').value = order.contact3 || '';
    document.getElementById('newOrderPassword').value = order.password || '';
    document.getElementById('newOrderDescription').value = order.description || '';

    // åœ–ç‰‡é è¦½ï¼ˆå¦‚æœæœ‰ï¼‰
    if (order.menuImageUrl) {
        const img = document.getElementById('menuImagePreview');
        img.src = order.menuImageUrl;
        img.style.display = 'block';
    }

    showPage('NewOrderPage');
}
function togglePasswordVisibility(inputId) {
    const passwordInput = document.getElementById(inputId);
    const toggleBtn = passwordInput.nextElementSibling;
    
    // å®šç¾©çœ¼ç› SVG è·¯å¾‘ (ç›´æ¥é¡¯ç¤ºåœ–æ¡ˆ)
    const eyeOpen = `<svg class="eye-icon" viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>`;
    const eyeClosed = `<svg class="eye-icon" viewBox="0 0 24 24"><path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.82l2.92 2.92c1.51-1.26 2.7-2.89 3.44-4.74-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/></svg>`;

    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleBtn.innerHTML = eyeOpen;
    } else {
        passwordInput.type = 'password';
        toggleBtn.innerHTML = eyeClosed;
    }
}
    </script>

</body>
</html>

